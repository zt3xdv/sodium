// File Manager Styles
.file-manager {
  display: flex;
  flex-direction: column;
  height: calc(100vh - var(--navbar-height));
}

.file-toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-3) var(--space-4);
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  gap: var(--space-3);
  flex-wrap: wrap;

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-sm);
    overflow-x: auto;
  }

  .breadcrumb-item {
    color: var(--text-secondary);
    cursor: pointer;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    white-space: nowrap;

    &:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    &:last-child {
      color: var(--text-primary);
    }
  }

  .breadcrumb-sep {
    color: var(--text-tertiary);
  }

  .file-actions {
    display: flex;
    gap: var(--space-2);
  }
}

.file-list-container {
  flex: 1;
  overflow: auto;
  position: relative;
}

.file-search {
  display: flex;
  align-items: center;
  gap: var(--space-1);
  flex: 1;
  max-width: 250px;

  .input {
    flex: 1;
  }
}

.view-toggle {
  display: flex;
  gap: 2px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-sm);
  padding: 2px;

  .btn.active {
    background: var(--bg-elevated);
    color: var(--accent);
  }
}

.bulk-actions {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-2) var(--space-4);
  background: var(--accent);
  color: white;
  animation: slideDown 0.2s ease;

  .bulk-count {
    font-weight: 600;
    font-size: var(--text-sm);
  }

  .btn {
    color: white;
    border-color: rgba(255, 255, 255, 0.3);

    &:hover {
      background: rgba(255, 255, 255, 0.1);
    }
  }

  .btn-danger {
    background: var(--danger);
    border-color: var(--danger);
  }
}

.drop-zone {
  position: absolute;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(59, 130, 246, 0.1);
  border: 3px dashed var(--accent);
  border-radius: var(--radius-lg);
  z-index: 100;
  backdrop-filter: blur(4px);

  &.active {
    display: flex;
  }

  .drop-zone-content {
    text-align: center;
    color: var(--accent);

    p {
      margin-top: var(--space-3);
      font-size: var(--text-lg);
      font-weight: 600;
    }
  }
}

.file-table {
  width: 100%;
  border-collapse: collapse;

  thead {
    position: sticky;
    top: 0;
    background: var(--bg-secondary);
    z-index: 1;

    th {
      padding: var(--space-3) var(--space-4);
      text-align: left;
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-tertiary);
      border-bottom: 1px solid var(--border);
    }
  }

  .col-checkbox {
    width: 40px;
    text-align: center;
  }

  .col-name {
    min-width: 200px;
  }

  .col-size {
    width: 100px;
  }

  .col-modified {
    width: 150px;
  }

  .col-actions {
    width: 120px;
    text-align: right;
  }

  tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background 0.15s ease;

    &:hover {
      background: var(--bg-tertiary);
    }

    &.selected {
      background: var(--accent-muted);
    }
  }

  td {
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-sm);
  }

  .loading, .empty {
    text-align: center;
    color: var(--text-secondary);
    padding: var(--space-8) !important;
  }
}

.file-row {
  cursor: pointer;

  .file-icon {
    display: inline-flex;
    margin-right: var(--space-2);
    color: var(--text-secondary);
    vertical-align: middle;
  }

  .file-name {
    vertical-align: middle;
  }

  .action-btn {
    opacity: 0;
    transition: opacity 0.15s ease;
  }

  &:hover .action-btn {
    opacity: 1;
  }
}

.file-status {
  display: flex;
  justify-content: space-between;
  padding: var(--space-2) var(--space-4);
  background: var(--bg-secondary);
  border-top: 1px solid var(--border);
  font-size: var(--text-xs);
  color: var(--text-secondary);
}

.file-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: var(--space-3);
  padding: var(--space-4);

  .file-grid-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;

    &:hover {
      background: var(--bg-tertiary);
      border-color: var(--border-hover);
    }

    &.selected {
      background: var(--accent-muted);
      border-color: var(--accent);
    }

    .file-checkbox {
      position: absolute;
      top: var(--space-2);
      left: var(--space-2);
    }

    .file-grid-icon {
      color: var(--text-secondary);
      margin-bottom: var(--space-2);
    }

    .file-grid-name {
      font-size: var(--text-xs);
      text-align: center;
      word-break: break-word;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
  }

  .empty-grid {
    grid-column: 1 / -1;
    text-align: center;
    color: var(--text-secondary);
    padding: var(--space-8);
  }
}

// File Editor Modal
.file-editor {
  width: 100%;
  min-height: 400px;
  background: #000;
  color: #e5e5e5;
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  padding: var(--space-3);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  resize: vertical;
  line-height: 1.5;

  &:focus {
    outline: none;
    border-color: var(--accent);
  }
}

// Context Menu
.context-menu {
  position: fixed;
  background: var(--bg-elevated);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  padding: var(--space-1);
  min-width: 160px;
  z-index: 1000;

  .context-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius-sm);
    font-size: var(--text-sm);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;

    &:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    &.danger {
      color: var(--danger);
    }
  }

  .context-divider {
    height: 1px;
    background: var(--border);
    margin: var(--space-1) 0;
  }
}

// Upload Progress
.upload-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;

  .upload-modal {
    background: var(--bg-elevated);
    border-radius: var(--radius-lg);
    padding: var(--space-6);
    min-width: 300px;
    text-align: center;

    h3 {
      margin-bottom: var(--space-4);
    }

    .upload-progress {
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: var(--space-2);

      .upload-bar {
        height: 100%;
        background: var(--accent);
        transition: width 0.3s ease;
      }
    }

    .upload-info {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }
  }
}

// Bulk Actions Toolbar
.bulk-actions-bar {
  position: sticky;
  top: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-3) var(--space-4);
  background: var(--accent);
  color: var(--bg-primary);
  z-index: 10;
  animation: slideDown 0.2s ease;

  .selection-count {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-weight: 600;
    font-size: var(--text-sm);

    .count-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: var(--space-1) var(--space-2);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
    }
  }

  .bulk-actions {
    display: flex;
    gap: var(--space-2);

    .bulk-btn {
      display: flex;
      align-items: center;
      gap: var(--space-1);
      padding: var(--space-2) var(--space-3);
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: var(--radius-sm);
      color: inherit;
      font-size: var(--text-sm);
      cursor: pointer;
      transition: background 0.15s ease;

      &:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      &.danger:hover {
        background: var(--danger);
      }
    }
  }

  .close-bulk {
    background: transparent;
    border: none;
    color: inherit;
    cursor: pointer;
    padding: var(--space-1);
    border-radius: var(--radius-sm);

    &:hover {
      background: rgba(255, 255, 255, 0.2);
    }
  }
}

@keyframes slideDown {
  from {
    transform: translateY(-100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

// Context Menu mejorado
.context-menu {
  .context-item {
    .item-icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .item-label {
      flex: 1;
    }

    .item-shortcut {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
      margin-left: var(--space-4);
    }

    .submenu-arrow {
      margin-left: auto;
      color: var(--text-tertiary);
    }
  }

  .context-submenu {
    position: relative;

    .submenu-content {
      position: absolute;
      left: 100%;
      top: 0;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      padding: var(--space-1);
      min-width: 140px;
      opacity: 0;
      visibility: hidden;
      transform: translateX(-8px);
      transition: all 0.15s ease;
    }

    &:hover .submenu-content {
      opacity: 1;
      visibility: visible;
      transform: translateX(4px);
    }
  }

  .context-section-title {
    padding: var(--space-1) var(--space-3);
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--text-tertiary);
    text-transform: uppercase;
  }
}

// Drag & Drop Zone
.drag-drop-zone {
  position: relative;
  height: 100%;

  &.drag-active {
    .drop-overlay {
      opacity: 1;
      visibility: visible;
    }
  }
}

.drop-overlay {
  position: absolute;
  inset: 0;
  background: rgba(var(--accent-rgb), 0.1);
  border: 3px dashed var(--accent);
  border-radius: var(--radius-lg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-3);
  opacity: 0;
  visibility: hidden;
  transition: all 0.2s ease;
  z-index: 100;
  backdrop-filter: blur(4px);

  .drop-icon {
    width: 64px;
    height: 64px;
    color: var(--accent);
    animation: bounce 0.6s infinite alternate;
  }

  .drop-text {
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--accent);
  }

  .drop-hint {
    font-size: var(--text-sm);
    color: var(--text-secondary);
  }
}

@keyframes bounce {
  from {
    transform: translateY(0);
  }
  to {
    transform: translateY(-8px);
  }
}

.drop-success {
  animation: dropPulse 0.4s ease;
}

@keyframes dropPulse {
  0% {
    background: rgba(var(--accent-rgb), 0.1);
  }
  50% {
    background: rgba(var(--accent-rgb), 0.3);
  }
  100% {
    background: transparent;
  }
}

// Search Bar
.file-search {
  position: relative;
  flex: 1;
  max-width: 300px;

  .search-input {
    width: 100%;
    padding: var(--space-2) var(--space-3);
    padding-left: var(--space-8);
    background: var(--bg-tertiary);
    border: 1px solid transparent;
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    color: var(--text-primary);
    transition: all 0.15s ease;

    &::placeholder {
      color: var(--text-tertiary);
    }

    &:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--bg-primary);
    }
  }

  .search-icon {
    position: absolute;
    left: var(--space-3);
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
    pointer-events: none;
  }

  .search-clear {
    position: absolute;
    right: var(--space-2);
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: var(--space-1);
    border-radius: var(--radius-sm);

    &:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }
  }
}

.file-row.search-match {
  .file-name {
    .highlight {
      background: rgba(var(--warning-rgb), 0.3);
      color: var(--warning);
      padding: 0 2px;
      border-radius: 2px;
    }
  }
}

// Grid View
.file-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: var(--space-4);
  padding: var(--space-4);

  .file-grid-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-4);
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;

    &:hover {
      background: var(--bg-tertiary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    &.selected {
      border-color: var(--accent);
      background: var(--accent-muted);

      .select-check {
        opacity: 1;
      }
    }

    .select-check {
      position: absolute;
      top: var(--space-2);
      left: var(--space-2);
      width: 20px;
      height: 20px;
      background: var(--accent);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      opacity: 0;
      transition: opacity 0.15s ease;
    }

    &:hover .select-check {
      opacity: 0.5;
    }

    .grid-icon {
      width: 48px;
      height: 48px;
      margin-bottom: var(--space-3);
      color: var(--text-secondary);

      &.folder-icon {
        color: var(--warning);
      }
    }

    .grid-thumbnail {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: var(--radius-sm);
      margin-bottom: var(--space-3);
    }

    .grid-name {
      font-size: var(--text-sm);
      text-align: center;
      word-break: break-word;
      line-height: 1.3;
      max-height: 2.6em;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .grid-size {
      font-size: var(--text-xs);
      color: var(--text-tertiary);
      margin-top: var(--space-1);
    }
  }
}

// Vista Toggle
.view-toggle {
  display: flex;
  background: var(--bg-tertiary);
  border-radius: var(--radius-md);
  padding: 2px;

  .view-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-2);
    background: transparent;
    border: none;
    border-radius: var(--radius-sm);
    color: var(--text-tertiary);
    cursor: pointer;
    transition: all 0.15s ease;

    &:hover {
      color: var(--text-primary);
    }

    &.active {
      background: var(--bg-elevated);
      color: var(--accent);
      box-shadow: var(--shadow-sm);
    }
  }
}

// Progress Overlay mejorado
.upload-overlay {
  .upload-modal {
    max-width: 400px;
    width: 90%;

    .upload-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-4);

      h3 {
        margin: 0;
      }

      .upload-count {
        font-size: var(--text-sm);
        color: var(--text-secondary);
      }
    }

    .upload-list {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: var(--space-4);

      .upload-item {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-2) 0;
        border-bottom: 1px solid var(--border);

        &:last-child {
          border-bottom: none;
        }

        .upload-item-icon {
          color: var(--text-secondary);
          flex-shrink: 0;
        }

        .upload-item-info {
          flex: 1;
          min-width: 0;

          .upload-item-name {
            font-size: var(--text-sm);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }

          .upload-item-progress {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            margin-top: var(--space-1);
            overflow: hidden;

            .progress-bar {
              height: 100%;
              background: var(--accent);
              transition: width 0.2s ease;
            }
          }
        }

        .upload-item-status {
          font-size: var(--text-xs);
          color: var(--text-tertiary);

          &.complete {
            color: var(--success);
          }

          &.error {
            color: var(--danger);
          }
        }
      }
    }

    .upload-actions {
      display: flex;
      gap: var(--space-3);
      justify-content: center;

      .cancel-btn {
        padding: var(--space-2) var(--space-4);
        background: var(--bg-tertiary);
        border: none;
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: var(--text-sm);
        cursor: pointer;
        transition: background 0.15s ease;

        &:hover {
          background: var(--danger);
          color: white;
        }
      }
    }

    .upload-total-progress {
      margin-bottom: var(--space-3);

      .total-bar {
        height: 8px;
        background: var(--bg-tertiary);
        border-radius: 4px;
        overflow: hidden;

        .total-fill {
          height: 100%;
          background: linear-gradient(90deg, var(--accent), var(--accent-light, var(--accent)));
          transition: width 0.3s ease;
        }
      }

      .total-info {
        display: flex;
        justify-content: space-between;
        margin-top: var(--space-2);
        font-size: var(--text-xs);
        color: var(--text-secondary);
      }
    }
  }
}

// Clipboard Indicator
.clipboard-indicator {
  position: fixed;
  bottom: var(--space-4);
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  background: var(--bg-elevated);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  z-index: 100;
  animation: slideUp 0.3s ease;

  &.cut-mode {
    border-color: var(--warning);

    .clipboard-icon {
      color: var(--warning);
    }
  }

  &.copy-mode {
    border-color: var(--accent);

    .clipboard-icon {
      color: var(--accent);
    }
  }

  .clipboard-icon {
    flex-shrink: 0;
  }

  .clipboard-info {
    .clipboard-count {
      font-weight: 600;
      font-size: var(--text-sm);
    }

    .clipboard-action {
      font-size: var(--text-xs);
      color: var(--text-secondary);
    }
  }

  .clipboard-actions {
    display: flex;
    gap: var(--space-2);

    .clipboard-btn {
      padding: var(--space-2) var(--space-3);
      background: var(--accent);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      font-size: var(--text-xs);
      cursor: pointer;
      transition: all 0.15s ease;

      &:hover {
        filter: brightness(1.1);
      }

      &.clear-btn {
        background: var(--bg-tertiary);
        color: var(--text-secondary);

        &:hover {
          background: var(--danger);
          color: white;
        }
      }
    }
  }
}

@keyframes slideUp {
  from {
    transform: translateX(-50%) translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }
}

// Responsive
@media (max-width: 768px) {
  .file-toolbar {
    flex-direction: column;
    align-items: stretch;

    .file-actions {
      justify-content: flex-end;
    }

    .file-search {
      max-width: none;
    }
  }

  .col-modified {
    display: none;
  }

  .file-grid {
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: var(--space-3);
  }

  .bulk-actions-bar {
    flex-wrap: wrap;
    gap: var(--space-2);

    .bulk-actions {
      flex-wrap: wrap;
    }
  }

  .clipboard-indicator {
    left: var(--space-3);
    right: var(--space-3);
    transform: none;
    flex-wrap: wrap;
  }

  .context-menu .context-submenu .submenu-content {
    position: fixed;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
  }
}
